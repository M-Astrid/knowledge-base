<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Основная идея](#%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%B0%D1%8F-%D0%B8%D0%B4%D0%B5%D1%8F)
- [Как работает](#%D0%BA%D0%B0%D0%BA-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82)
- [Визуальное представление](#%D0%B2%D0%B8%D0%B7%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D0%BF%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5)
- [Почему это важно](#%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D1%8D%D1%82%D0%BE-%D0%B2%D0%B0%D0%B6%D0%BD%D0%BE)
- [Примеры использования](#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
- [Итог](#%D0%B8%D1%82%D0%BE%D0%B3)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

Паттерн **Circuit Breaker** (предохранитель цепи) — это архитектурный шаблон, предназначенный для повышения устойчивости распределённых систем, предотвращая их поломки и ухудшение работы при сбоях в внешних сервисах или компонентах.

---

### Основная идея

Когда система вызывает внешние сервисы или ресурсы, существует риск, что эти сервисы могут стать недоступными или работать с ошибками. Постоянные попытки обращения к ним могут привести к цепной реакции проблем, переполнению ресурсов или ухудшению общего состояния системы.

**Circuit Breaker** действует как автоматический предохранитель:  
- Он отслеживает состояние вызовов к внешнему сервису.  
- В случае множества неудач «размыкает цепь» — прекращает попытки вызова этого сервиса на некоторое время.  
- После истечения времени «размыкания» — «замыкает» цепь снова, позволяя попыткам восстановить работу сервиса и проверить его состояние.

---

### Как работает

1. **Closed (замкнутая цепь):**  
   — Все вызовы проходят нормально.  
   — Circuit Breaker отслеживает успехи и неудачи.

2. **Open (разомкнутая цепь):**  
   — После достижения порога ошибок (например, 5 ошибок подряд) Circuit Breaker «размыкает» цепь.  
   — Все последующие вызовы сразу возвращают ошибку или используют fallback (резервный механизм), не обращаясь к внешнему сервису.  
   — Время «размыкания» — фиксированный интервал.

3. **Half-Open (полузамкнутая цепь):**  
   — После истечения времени, Circuit Breaker позволяет сделать ограниченное число тестовых вызовов.  
   — Если они проходят успешно — цепь «замыкается» обратно (в статус Closed).  
   — Если снова возникают ошибки — цепь остаётся разомкнутой.

---

### Визуальное представление

```
[Closed] -> (Много успешных вызовов) -> остаётся закрытым
[Closed] -> (Много ошибок) -> переходит в [Open]
[Open] -> (Истёк таймер) -> переходит в [Half-Open]
[Half-Open] -> (Успешный вызов) -> [Closed]
[Half-Open] -> (Ошибочный вызов) -> [Open]
```

---

### Почему это важно

- **Защита системы:**  
  Предотвращает дальнейшие сбои и перегрузки внешних сервисов или внутренних компонентов.

- **Обеспечение отказоустойчивости:**  
  Вместо того, чтобы ждать и терпеть сбои, система быстро реагирует, используя fallback или возвращая ошибку.

- **Автоматическое восстановление:**  
  После периода размыкания, система автоматически проверяет, можно ли снова обращаться к сервису.

---

### Примеры использования

- В микросервисной архитектуре при вызове REST API внешнего сервиса или базы данных.  
- В системах, использующих удалённые ресурсы, такие как платежные шлюзы, сторонние API, облачные сервисы.  
- В системах, где важна высокая доступность и отказоустойчивость.

---

### Итог

**Circuit Breaker** — это ключевой паттерн для защиты системы от каскадных сбоев, обеспечивающий автоматическое управление попытками обращения к ненадёжным или перегруженным компонентам, позволяя системе оставаться стабильной и реагировать на проблемы более эффективно.

---

Если нужно — могу привести пример реализации или конкретные инструменты и библиотеки!